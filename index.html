<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>متجر التطبيقات مع Firebase</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<style>
body { font-family: Arial; margin:0; padding:0; background:#f0f2f5; }
header { background:#1e90ff; color:white; padding:15px; text-align:center; }
h1 { margin:0; font-size:28px; }
nav { display:flex; flex-wrap:wrap; background:#0b5ed7; padding:10px; }
nav button { margin:5px; padding:8px 12px; background:#1e90ff; border:none; color:white; cursor:pointer; border-radius:4px; }
nav button:hover { background:#084298; }
#search { width:95%; padding:10px; margin:10px auto; display:block; border-radius:5px; border:1px solid #ccc; }
.app-container { display:grid; grid-template-columns: repeat(auto-fill,minmax(250px,1fr)); gap:15px; padding:15px; }
.app-card { background:white; border-radius:8px; padding:15px; box-shadow:0 2px 5px rgba(0,0,0,0.1); display:flex; flex-direction:column; }
.app-card img { width:100%; height:150px; object-fit:cover; border-radius:5px; margin-bottom:10px; }
.app-card h3 { margin:5px 0; color:#1e90ff; }
.app-card p { flex:1; font-size:14px; color:#333; }
button { margin-top:10px; padding:8px; border:none; color:white; border-radius:4px; cursor:pointer; }
.downloadBtn { background:#28a745; }
.downloadBtn:hover { background:#1e7e34; }
.commentBtn { background:#17a2b8; }
.commentBtn:hover { background:#117a8b; }
input[type=text] { width:100%; padding:5px; margin-top:5px; border-radius:4px; border:1px solid #ccc; }
form { background:white; padding:15px; margin:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); display:none; }
</style>
</head>
<body>

<header><h1>متجر التطبيقات المتقدم</h1></header>

<nav>
<button onclick="filterApps('All')">الكل</button>
<button onclick="filterApps('Android')">أندرويد</button>
<button onclick="filterApps('Windows')">ويندوز</button>
</nav>

<input type="text" id="search" placeholder="ابحث عن تطبيق..." onkeyup="searchApps()">

<div class="app-container" id="appList"></div>

<!-- لوحة المطور -->
<form id="adminPanel">
<h2>لوحة المطور</h2>
<input type="text" id="appName" placeholder="اسم التطبيق" required>
<input type="text" id="appDesc" placeholder="وصف التطبيق" required>
<select id="appType">
<option value="Android">أندرويد</option>
<option value="Windows">ويندوز</option>
</select>
<select id="appService">
<option value="حماية">الحماية</option>
<option value="إنتاجية">الإنتاجية</option>
<option value="ألعاب">الألعاب</option>
<option value="تصوير">التصوير</option>
<option value="صوت وفيديو">الصوت والفيديو</option>
</select>
<input type="file" id="appImageFile" accept="image/*">
<input type="file" id="appDownloadFile" accept=".exe,.apk,.zip,.iso">
<input type="text" id="appDownloadLink" placeholder="أو رابط تنزيل خارجي">
<button type="submit">إضافة التطبيق</button>
</form>

<footer id="privacyBtn">
<p>© 2026 متجر التطبيقات – جميع الحقوق محفوظة</p>
<p>سياسة الخصوصية | شروط الاستخدام</p>
</footer>

<script>
// ==================== Firebase ======================
const firebaseConfig = {
  apiKey: "AIzaSyCtRKlBs3R5TvDMSHoqPzFPgtQ8i9FEWMg",
  authDomain: "connectdz-69edd.firebaseapp.com",
  projectId: "connectdz-69edd",
  storageBucket: "connectdz-69edd.appspot.com",
  messagingSenderId: "211254589080",
  appId: "1:211254589080:web:c3256facc187314ac142ed"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ==================== الوظائف ======================
const appList = document.getElementById('appList');
const adminPanel = document.getElementById('adminPanel');
let clickCount=0;
let appImageBase64="";
let appFileBase64="";

// إظهار لوحة المطور بعد 5 نقرات
document.getElementById('privacyBtn').addEventListener('click', ()=>{
  clickCount++;
  if(clickCount>=5) adminPanel.style.display='block';
});

// قراءة الصورة
document.getElementById('appImageFile').addEventListener('change', e=>{
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=evt=>appImageBase64=evt.target.result;
  reader.readAsDataURL(file);
});

// قراءة الملف
document.getElementById('appDownloadFile').addEventListener('change', e=>{
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=evt=>appFileBase64=evt.target.result;
  reader.readAsDataURL(file);
});

// إضافة التطبيق
adminPanel.addEventListener('submit', e=>{
  e.preventDefault();
  const name = document.getElementById('appName').value;
  const desc = document.getElementById('appDesc').value;
  const type = document.getElementById('appType').value;
  const service = document.getElementById('appService').value;
  const downloadLink = document.getElementById('appDownloadLink').value;

  if(!appImageBase64){ alert('اختر صورة للتطبيق'); return; }
  if(!appFileBase64 && !downloadLink){ alert('اختر ملف التطبيق أو رابط خارجي'); return; }

  db.collection("apps").add({
    name,
    desc,
    type,
    service,
    img: appImageBase64,
    download: appFileBase64 || null,
    downloadLink: downloadLink || null,
    comments: [],
    rating: 0
  });
  e.target.reset();
  appImageBase64=""; appFileBase64="";
});

// عرض التطبيقات
function displayApps(snapshot){
  appList.innerHTML="";
  snapshot.forEach(doc=>{
    const a = doc.data();
    const id = doc.id;
    const div=document.createElement('div');
    div.className='app-card';
    const link = a.downloadLink ? a.downloadLink : a.download;
    div.innerHTML=`
      <img src="${a.img}" alt="${a.name}">
      <h3>${a.name} (${a.service})</h3>
      <p>${a.desc}</p>
      <a href="${link}" download="${a.name}"><button class="downloadBtn">تحميل</button></a>
      <div>
        <input type="text" id="commentInput${id}" placeholder="اكتب تعليقك هنا">
        <button class="commentBtn" onclick="addComment('${id}')">أضف تعليق</button>
      </div>
      <div id="comments${id}">${(a.comments||[]).map(c=>'<p>'+c+'</p>').join('')}</div>
    `;
    appList.appendChild(div);
  });
}

// التعليقات
function addComment(id){
  const input = document.getElementById(`commentInput${id}`);
  const comment = input.value.trim();
  if(comment==="") return;
  const docRef = db.collection("apps").doc(id);
  docRef.get().then(doc=>{
    const comments = doc.data().comments || [];
    comments.push(comment);
    docRef.update({comments});
  });
  input.value="";
}

// متابعة أي تغييرات في Firebase
db.collection("apps").onSnapshot(snapshot=>{
  displayApps(snapshot);
});

// البحث
function searchApps(){
  const keyword=document.getElementById('search').value.toLowerCase();
  db.collection("apps").get().then(snapshot=>{
    const filtered = snapshot.docs.filter(doc=>{
      const a = doc.data();
      return a.name.toLowerCase().includes(keyword) || a.desc.toLowerCase().includes(keyword);
    });
    displayApps({forEach: f => filtered.forEach(f)});
  });
}

// تصفية الأقسام
function filterApps(type){
  if(type==='All') db.collection("apps").get().then(snapshot=>displayApps(snapshot));
  else db.collection("apps").where("type","==",type).get().then(snapshot=>displayApps(snapshot));
}
</script>

</body>
</html>
