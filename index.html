<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HEX App Store</title>
<style>
body { font-family: Arial; background:#121212; color:#fff; margin:0; padding:0;}
header{background:#1E1E1E; padding:20px;text-align:center;}
button{padding:10px 20px;margin:5px; cursor:pointer;}
.card{background:#222; padding:15px;margin:10px; border-radius:8px; display:inline-block; width:200px;}
.card img{width:100%; border-radius:5px;}
#appsContainer{display:flex; flex-wrap:wrap; justify-content:center;}
</style>
</head>
<body>

<header>
<h1>HEX App Store</h1>
<p>مرحبا بك في متجر التطبيقات</p>
</header>

<section id="publishAppSection" style="text-align:center; margin:20px;">
<h2>نشر تطبيق جديد</h2>
<input type="text" id="appName" placeholder="اسم التطبيق"><br>
<input type="text" id="appDesc" placeholder="وصف التطبيق"><br>
<input type="text" id="appPlatform" placeholder="Android / Windows"><br>
<input type="text" id="appCategory" placeholder="فئة التطبيق (مثل حماية)"><br>
<input type="text" id="appImage" placeholder="رابط الصورة"><br>
<input type="text" id="appLink" placeholder="رابط التحميل"><br>
<button onclick="publishApp()">نشر التطبيق</button>
</section>

<hr>

<section id="appsContainer">
<!-- التطبيقات ستظهر هنا -->
</section>

<script type="module">
// ================== Supabase Setup ==================
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const SUPABASE_URL="https://iwgmnfuxxomwtwmkfzjn.supabase.co";
const SUPABASE_KEY="sb_publishable_HasRVGxmcFaYhgqv1IMWhA_huNgIfiJ";
const supabase=createClient(SUPABASE_URL,SUPABASE_KEY);

// ================== نشر التطبيقات ==================
async function publishApp(){
    const name = document.getElementById("appName").value;
    const desc = document.getElementById("appDesc").value;
    const platform = document.getElementById("appPlatform").value;
    const category = document.getElementById("appCategory").value;
    const image = document.getElementById("appImage").value;
    const link = document.getElementById("appLink").value;

    if(!name || !desc || !platform || !category || !link){
        alert("يرجى ملء جميع الحقول المطلوبة!");
        return;
    }

    const { data, error } = await supabase
        .from('apps')
        .insert([{ name, desc, platform, category, image, link, created_at: new Date() }]);

    if(error){
        alert("حدث خطأ أثناء نشر التطبيق: " + error.message);
    } else {
        alert("تم نشر التطبيق بنجاح!");
        loadApps();
        document.getElementById("appName").value="";
        document.getElementById("appDesc").value="";
        document.getElementById("appPlatform").value="";
        document.getElementById("appCategory").value="";
        document.getElementById("appImage").value="";
        document.getElementById("appLink").value="";
    }
}

// ================== عرض التطبيقات ==================
async function loadApps(){
    const { data: apps, error } = await supabase
        .from('apps')
        .select('*')
        .order('created_at', { ascending:false });

    if(error){
        console.log("خطأ في تحميل التطبيقات:", error.message);
        return;
    }

    const container = document.getElementById("appsContainer");
    container.innerHTML="";

    apps.forEach(app=>{
        const card = document.createElement("div");
        card.className="card";
        card.innerHTML=`
            <img src="${app.image || 'https://via.placeholder.com/150'}">
            <h3>${app.name}</h3>
            <p>${app.desc}</p>
            <p>منصة: ${app.platform}</p>
            <p>فئة: ${app.category}</p>
            <a href="${app.link}" target="_blank"><button style="background:green;color:white;">تنزيل</button></a>
        `;
        container.appendChild(card);
    });
}

// ================== تحميل التطبيقات عند فتح الصفحة ==================
loadApps();

</script>

</body>
</html>
